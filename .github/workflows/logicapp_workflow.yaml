jobs:
  create-logicapp-infra:
    env:
      AZURE_LOGICAPP_PACKAGE_PATH: .
      DEPLOY_ENV: ${{ matrix.azureenv }}
      DOTNET_VERSION: 3.1.301
      DPLOYMENT_NAME: TestlogicApp1
      LOCATION: eastus2
      PARAMETERFILE_NAME: parameters.json
    environment: sandbox
    name: Create logicapp infra
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Set the env variables according to env
      run: "ACTIONS_ALLOW_UNSECURE_COMMANDS=true\nRG_NAME=`grep \"^RESOUECE_GROUP_NAME=\"\
        \  .github/env/dev.env|awk -F\"=\" '{ print $2 }'` \necho RG_NAME=$RG_NAME\
        \ >> $GITHUB_ENV\nAZURE_SUBSCRIPTION=`grep \"^SUBSCRIPTION_ID=\"  .github/env/dev.env|awk\
        \ -F\"=\" '{ print $2 }'` \necho AZURE_SUBSCRIPTION=$AZURE_SUBSCRIPTION >>\
        \ $GITHUB_ENV\nTEMPLATE_NAME=`grep \"^TEMPLATE_NAME=\"  .github/env/dev.env|awk\
        \ -F\"=\" '{ print $2 }'` \necho TEMPLATE_NAME=$TEMPLATE_NAME >> $GITHUB_ENV\n\
        echo ${{matrix.azureenv}}\necho $DEPLOY_ENV\n"
    - name: Login to Azure
      uses: azure/login@v1
      with:
        creds: ${{ secrets.AZURE_CREDENTIALS }}
    - id: deploy
      uses: azure/arm-deploy@v1
      with:
        deploymentName: ${{ env.DPLOYMENT_NAME }}
        parameters: ${{ env.PARAMETERFILE_NAME }}
        resourceGroupName: ${{ env.RG_NAME }}
        template: ${{ env.TEMPLATE_NAME }}
    strategy:
      matrix:
        azureenv:
        - sandbox
name: Create azure infra for logic apps
'on':
  push:
    paths:
    - .github/workflows/logicapp_workflow.yaml
    - '*.json'
